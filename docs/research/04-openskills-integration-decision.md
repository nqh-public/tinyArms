# OpenSkills-Inspired Skills Architecture

**Research Date**: 2025-10-30
**Status**: Researched - Ready for Implementation
**Phase**: 02 (Skills System Architecture)
**Implementation**: Phase 1 (Framework First)

**Sources**:
- OpenSkills spec: https://github.com/numman/openskills
- Plugin patterns: research/04-plugin-architecture-patterns.md
- User clarification: 4-round AskUserQuestion (2025-10-30)

---

## Problem

**Current**: Monolithic skill (code-linting only)
- Hardcoded CLI: cli.ts:22-83
- Embedded prompts: linter.ts:44-78
- No path to 2nd skill without duplication

**Decision**: Define architecture NOW before 2nd skill

---

## Solution

### Tooling: skill-creator

**Generate skills**: Use `.claude/skills/skill-creator/scripts/init_skill.py`
```bash
python3 .claude/skills/skill-creator/scripts/init_skill.py code-linting --path apps/tinyArms/skills
```

**Validate skills**: Use `quick_validate.py` before commits
```bash
python3 .claude/skills/skill-creator/scripts/quick_validate.py apps/tinyArms/skills/code-linting
```

### Structure (Per Skill)

```
skills/code-linting/
├── SKILL.md           # Generated by skill-creator (OpenSkills format)
├── config.yaml        # tinyArms runtime config (custom)
├── executor.ts        # Core logic (TypeScript, custom)
├── scripts/           # Optional: Executable helpers
├── references/        # Optional: Docs loaded to context
└── assets/            # Optional: Templates/configs
```

### SKILL.md (skill-creator Format)

**Requirements**:
- YAML frontmatter: `name:` (hyphen-case), `description:` (no `<>`)
- Structure pattern: Workflow-Based, Task-Based, Capabilities-Based, or Reference
- Must pass: `quick_validate.py`

**Example**:
```markdown
---
name: code-linting
description: Lint code against constitutional principles using Qwen2.5-Coder-3B. Use when checking Architecture-First, DRY, or Universal Reusability violations.
---

# Code Linting Skill

## Overview
Analyze code for constitutional violations NOT caught by pre-commit hooks.

## When to Use
- Pre-commit linting (fast)
- Weekly deep scans (slow)
- Manual code review

## Workflow

**Step 1**: Run linting
```bash
tinyarms lint <file> [--constitution <path>]
```

**Step 2**: Parse JSON output
```json
{
  "violations": [...],
  "summary": "...",
  "confidence": 0.85
}
```

## Success Criteria
- Exit code 0 if no violations
- Exit code 1 if violations found
```

### config.yaml (tinyArms-Specific)

**Purpose**: Runtime configuration

```yaml
model:
  level: 2
  primary: qwen2.5-coder:3b-instruct
  confidence_threshold: 0.85

autonomous:
  watch_patterns: ["**/*.ts"]
  schedule: "*/30 * * * *"

performance:
  max_latency_ms: 3000
  battery_constraint: "idle_only"

prompts:
  system: "You are a linter...\n{constitution}"
  user: "Analyze:\n```\n{code}\n```"
```

---

## Architecture

### Core Framework (src/core/)

| Component | Purpose |
|-----------|---------|
| skill-loader.ts | Load SKILL.md + config.yaml |
| skill-executor.ts | Execute skill (core logic) |
| skill-registry.ts | Auto-discover skills/ |

### Wrappers (src/wrappers/)

| Component | Purpose |
|-----------|---------|
| cli-wrapper.ts | CLI invocation (simple) |
| autonomous-wrapper.ts | LaunchAgent (batching/caching) |

**Pattern**: Wrapper → Core Skill → Result

---

## Invocation Modes

| Mode | Trigger | Characteristics |
|------|---------|-----------------|
| CLI | `tinyarms lint file.ts` | Single-shot, immediate |
| Autonomous | LaunchAgent (schedule) | Batched, cached |
| Claude Code | `openskills read tinyarms/code-linting` | Progressive disclosure |

---

## Trade-Offs

### ✅ Benefits

- Modular architecture (easy to add skills 2-5)
- OpenSkills compatible (agents can invoke)
- Dual-mode support (CLI + autonomous)
- MCP-ready structure

### ❌ Costs

- Upfront work (framework before 2nd skill)
- 3 files per skill vs 1 monolithic
- Violates Principle XVII? (extract after 3+ duplicates)

**Justification**: Architecture decision, not code extraction. User decided on OpenSkills format.

---

## Implementation Plan

### Phase 1: Generate Skills with skill-creator

1. Run `init_skill.py` for code-linting
2. Edit generated SKILL.md (replace TODOs, choose structure pattern)
3. Add config.yaml (tinyArms-specific runtime config)
4. Move linter.ts logic to executor.ts (no changes)
5. Validate with `quick_validate.py`

**Success**: `tinyarms lint file.ts` works identically + SKILL.md valid

### Phase 2: Validate

1. Add 2nd skill (file-naming OR markdown-analysis)
2. Extract ACTUAL duplicated patterns
3. Document learnings

**Success**: 2 skills working, shared code extracted

### Phase 3: Autonomous

1. Create autonomous-wrapper.ts
2. Add batching + semantic caching
3. LaunchAgent integration

**Success**: Skills run automatically on schedule

---

## Expected Impact

- **Modularity**: Clean plugin architecture for 5 skills
- **Agent integration**: Claude Code/Cursor/Aider can invoke
- **Maintainability**: Self-contained skills
- **Timeline**: 3-4 weeks (framework → validate → autonomous)

---

## References

- OpenSkills: https://github.com/numman/openskills
- Plugin patterns: research/04-plugin-architecture-patterns.md
- Current code: cli.ts:22-83, linter.ts:44-78

---

**Decision**: Adopt OpenSkills SKILL.md + tinyArms config.yaml architecture
**Status**: Ready for Phase 1 implementation
**Next**: Build framework before 2nd skill
